# ТЗ: Telegram-бот для 360‑градусного фидбэка

## 0. Цель
Автоматизировать сбор 360‑фидбэка в Telegram: ≤ 5 параллельных циклов, фиксированная анкета (оценки 0–3 + открытые вопросы), хранение данных в Google Sheets, напоминания, ежедневная HR‑сводка и итоговый отчёт.

---

## 1. Роли
| Роль | Возможности |
|------|-------------|
| **HR‑админ** | `/new_cycle`, `/cancel`, `/status`; получает сводки и отчёты |
| **Респондент** | Заполняет назначенные анкеты |
| **Бот** | Реализует все функции ниже |

---

## 2. Справочник сотрудников
* Google Sheets → таблица **`Employees`** (корп. аккаунт).  
* Колонки (фиксированы): `Employee_ID`, `Full_Name`, `Telegram_ID`, `Position`, `Manager_ID`.

---

## 3. Cycle Management
| Шаг | Детали |
|-----|--------|
| **Создание** | `/new_cycle` → HR вводит `Target`, `Respondent_IDs[]`, `Deadline`.<br>Проверяется лимит ≤ 5 активных циклов. |
| **Cycle ID** | Формат `YYYYMMDD_<TargetEmployeeID>` (напр. `20250622_EMP123`). |
| **Отмена** | `/cancel <Cycle_ID>` переводит цикл в `Closed` без отчёта. |

---

## 4. Анкета
* 8 вопросов‑компетенций, шкала **0–3** с текстовыми подсказками.  
* 2 открытых поля: «Сильные стороны», «Точки роста».  
* «Отправить» доступно только после заполнения всех полей.  
* Черновик хранится (Redis) по `Telegram_ID + Cycle_ID`.

---

## 5. Процесс респондента
1. Получает ссылку `t.me/bot?start=<CycleID_Random>`.  
2. Заполняет анкету на коллегу.  
3. Пока не нажал «Отправить», другая анкета не выдаётся.  
4. После сабмита:  
   * есть ещё задания → новая ссылка;  
   * иначе → «Спасибо, опросы закончились».

---

## 6. Хранение данных
* **Один лист = один цикл**; имя `YYYY-MM-DD_TargetName`.  
* Строка = ответ: `Cycle_ID`, `Respondent_ID`, `Submitted_at`, `Q1…Q8`, `Strengths`, `Growth`.  
* **Append‑only.** Авто‑архив не нужен.

---

## 7. Таймеры (МСК)
| Событие | Время / период |
|---------|----------------|
| HR‑сводка | 09:00 ежедневно |
| Напоминание | Каждые 3 дня |
| Финальный пинг | 2 дня до `Deadline` |

---

## 8. HR‑сводка (пример)
```
Цикл: Иванова А.
Готово 4/7 (57 %), дедлайн через 5 дн
 • Иванов — ✅
 • Петров — ⏳
 ...
```

---

## 9. Отчёт (`Reported`)
1. **Markdown‑сообщение**  
   * средние 0–3 по 8 компетенциям (1 знак после запятой);  
   * буллет «сильное / точка роста» на каждую;  
   * общие сильные стороны / зоны роста (3–5 пунктов);  
   * анонимные цитаты → отбор: длина > 20 символов → GPT‑оценка информативности 0–10 → включаем > 6.  
2. **CSV‑ссылка** — прямой export листа Google Sheets.  
3. Список «не заполнил».

---

## 10. Алгоритмы и ограничения
| Пункт | Значение |
|-------|----------|
| Параллельность циклов | ≤ 5 |
| Минимум N | Нет, считаем всегда |
| Ошибки Google API | Логируем в stdout; без алертов/ретраев |
| Права бота | `spreadsheets.readonly` + `spreadsheets.append` |
| Язык | Весь UI и отчёты — русский |

---

## 11. Команды HR
```
/new_cycle
/cancel <Cycle_ID>
/status
```
